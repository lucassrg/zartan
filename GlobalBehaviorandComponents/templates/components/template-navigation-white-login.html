<nav class="navbar navbar-marketing navbar-expand-lg bg-white navbar-light" id="sidenavAccordion" style="margin-bottom: 5px">
    <div class="container">
        {% if config.settings.app_logo != "" %}
             <a href="/index"><img src={{config.settings.app_logo}} border='0' style="max-height:100px;max-width:300px;height:auto;width:auto;"></a>
        {% else %}
             <a class="navbar-brand text-primary" href="/index">{{config.settings.app_name}}</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><i data-feather="menu"></i></button>
        {% endif %}
        {% include config.settings.app_template + '/'+navitems %}
        {% if user_info is none or user_info is not defined %}
                <ul class="navbar-nav align-items-center ml-auto">
                    <li class="nav-item dropdown no-caret mr-3 dropdown-user">
                    <a class="btn-primary btn rounded-pill px-4 ml-lg-4 dropdown-toggle" href="javascript:void(0);" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Login</a>
                    <div class="dropdown-menu dropdown-menu-right border-0 shadow animated--fade-in-up" aria-labelledby="navbarDropdownUserImage">
                        <form role="login" class="navbar-form navbar-left" style="margin-bottom: 5px; margin-left: 10px; margin-right: 10px;">
                            <div class="form-group" style="margin-bottom: 5px;margin-top: 5px;">
                             <input type="text" id="login-un" name="username" placeholder="Username" class="form-control" autocomplete="off" style="padding: 5px;margin-bottom:8px;">
                             <input type="password" id="login-pw" name="password" placeholder="Password" class="form-control" autocomplete="off" style="padding: 5px;margin-bottom:10px;">
                            </div>
                            <button type="button" id="login-button" onclick="do_login(this.form.username.value, this.form.password.value)" class="btn btn-primary" style="margin-bottom: 5px; margin-left: 5px; margin-right: 5px;float: right;">Sign In</button>
                        </form>
                    </div>
                    </li>
                </ul>
        {% else %}
                <ul class="navbar-nav align-items-center ml-auto">
                    <li class="nav-item dropdown no-caret mr-3 dropdown-user">
                    <a class="btn-primary btn rounded-pill px-4 ml-lg-4 dropdown-toggle" href="javascript:void(0);" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Hi {{ user_info.name }}</a>
                    <div class="dropdown-menu dropdown-menu-right border-0 shadow animated--fade-in-up" aria-labelledby="navbarDropdownUserImage">
                        <h6 class="dropdown-header d-flex align-items-center">
                            <div class="dropdown-user-details">
                                <div class="dropdown-user-details-name">{{ user_info.name }}</div>
                                <div class="dropdown-user-details-email">{{ user_info.email }}</div>
                            </div>
                        </h6>
                        <div class="dropdown-divider"></div>
                        {% if config.settings.app_template in request.path  %}
                        <a class="dropdown-item" href="profile"><div class="dropdown-item-icon"><i data-feather="settings"></i></div>Profile</a>
                        {% else %}
                        <a class="dropdown-item" href="{{ config.settings.app_template }}/profile"><div class="dropdown-item-icon"><i data-feather="settings"></i></div>Profile</a>
                        {% endif %}
                        <a class="dropdown-item" href="/logout"><div class="dropdown-item-icon"><i data-feather="log-out"></i></div>Logout</a>
                    </div>
                    </li>
                </ul>
        {% endif %}
    </div>
</nav>
<script src="https://ok1static.oktacdn.com/assets/js/sdk/okta-auth-js/1.17.0/okta-auth-js.min.js" type="text/javascript"></script>
<script src="https://global.oktacdn.com/okta-signin-widget/3.8.2/js/okta-sign-in.min.js" type="text/javascript"></script>
<link href="https://global.oktacdn.com/okta-signin-widget/3.8.2/css/okta-sign-in.min.css" type="text/css" rel="stylesheet"/>
<script>
var loginBar = document.getElementById('navbar-login-alt');
if (loginBar) {
	loginBar.style.display = 'block';
}
var defaultWidgetCodeLink = document.getElementById('show-code');
if (defaultWidgetCodeLink) {
	defaultWidgetCodeLink.style.display = 'none';
}
</script>
<script id="theScript">
function do_login(un, pw) {
    var authClient = new OktaAuth({
        url: '{{config.okta_org_name}}',
        clientId: '{{config.client_id}}',
        redirectUri: '{{ config.redirect_uri}}',
        issuer: '{{config.issuer}}'
    });

    authClient.signIn({
        username: un,
        password: pw
    })
    .then(function(transaction) {
        if (transaction.status === 'SUCCESS') {
            // Step #1: get sessionToken
            console.log('sessionToken = ', transaction.sessionToken);

            // Step #2: retrieving a session cookie via OpenID Connect Authorization Endpoint
            // Requires the user be authenticated already (i.e. the transaction.sessionToken exists. See Step #1)
            // Uses response_mode=form_post: This will POST authorization_code and state to the redirectUri
            authClient.token.getWithRedirect({
                responseType: 'code',
                responseMode: 'query',
                state: '{{state}}',
                sessionToken: transaction.sessionToken,
                scopes: ['openid', 'profile', 'email'],
            });
        } else {
            throw 'We cannot handle the ' + transaction.status + ' status';
        }
    })
    .fail(function(err) {
        console.error(err);
    });
}
</script>
